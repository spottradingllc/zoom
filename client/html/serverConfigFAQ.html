<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>TODO: Write this FAQ</title>
        <!--- include knockout and jquery -->
        <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js" type="text/javascript"></script>
        <script src="http://code.jquery.com/jquery-2.1.1.js"></script>

        <!-- XML beautification library -->
        <script type="text/javascript" src="front-end/scripts/js/libs/vkbeautify.0.99.00.beta.js"></script>

        <!-- Boostrap javascript -->
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        
        <!-- CSS files -->
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="front-end/styles/app/spot.css"/>
    </head>
    <body>
        <!-- Navigation Bar -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <a class="navbar-brand" href="#">Zoom</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav">
                <li><a href="index.html#/application_state">Application State</a></li>
                <li><a href="serverConfig.html">Server Config</a></li>
                <li><a href="faq.html">Application State FAQ</a></li>
                <li class="active"><a href="serverConfigFAQ.html">Server Config FAQ</a></li>
              </ul>
            </div>
          </div>
        </nav>

        <div class="container-fluid">
            <div class="page-header" style="margin-top: 65px">
                <h1>TODO: Write this FAQ</h1>
                <div class="row">
                    <div class="col-md-6">
                        <div class="input-group">
                            <div class="input-group-btn">
                                <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                                    <span class="glyphicon glyphicon-chevron-down"></span>
                                </button>
                                <!-- populate dropdown menu using knockout observable array -->
                                <ul class="dropdown-menu" role="menu" data-bind="foreach: serverList">
                                    <li><a data-bind="text: $data" onclick="serverSelected(this.text)"></a></li>
                                </ul>
                            </div>
                            <input type="text"
                                   id="searchBox"
                                   class="form-control"
                                   data-bind="value: serverName, text: serverName"
                                   placeholder="Server name..."
                                   autofocus/>
                            <div class="input-group-btn">
                                <button type="button" class="btn btn-default" data-bind="click: clearPage">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </button>
                                <button type="button" class="btn btn-default" data-bind="click: search">
                                        Search
                                </button>
                                <button type="button" class="btn btn-default" data-bind="click: add">
                                    <span class="glyphicon glyphicon-plus"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- alerts for displaying callback success/error messages -->
            <div data-bind="with: alertsViewModel">
                <div class="alert alert-success" data-bind="visible: successMode">
                    <strong><span data-bind="text: successText"></span></strong>
                </div>
                <div class="alert alert-danger" data-bind="visible: errorMode">
                    <strong><span data-bind="text: errorText"></span></strong>
                </div>
            </div>

            <!-- panel for searching and editing server configurations -->
            <div class="panel panel-default"
                 data-bind="with: searchUpdateViewModel, visible: searchUpdateViewModel.visible">
                <div class="panel-heading">
                    <h3><span data-bind="text: $root.serverName"></span> <small>click XML to edit</small></h3>
                    <div class="btn-group">
                        <button type="button" class="btn btn-success" data-bind="click: validateXML">Push Configuration</button>
                        <button type="button" class="btn btn-danger" data-bind="click: deleteConfig">Delete Configuration</button>
                    </div>
                </div>
                <div class="panel-body">
                    <pre data-bind="text: serverConfig, value: serverConfig, event: {mouseout: editedConfig, click: closeAlerts}"
                         name="server-config" id="server-config" contenteditable="true"></pre>
                </div>
            </div>

            <!-- panel for adding new configurations -->
            <div class="panel panel-default" data-bind="with: addViewModel, visible: addViewModel.visible">
                <div class="panel-heading">
                    <h3>
                        <span data-bind="text: $root.serverName"></span>
                        <small> setup <span data-bind="text: $root.serverName"></span>'s XML configuration</small>
                    </h3>
                    <div class="btn-group">
                        <button type="button" class="btn btn-default" data-bind="click: addComponent">Add Component</button>
                        <button type="button" class="btn btn-success" data-bind="click: createXML">Generate XML</button>
                        <button type="button" class="btn btn-success" data-bind="click: pushConfig">Push Configuration</button>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="container-fluid">
                        <div data-bind="template: {name: 'component-template', foreach: serverComponents}">
                        </div>
                    </div>
                </div>
                <pre data-bind="text: serverXML, value: serverXML, visible: showXML"></pre>
            </div>
        </div>
    </body>

    <!-- knockout view models -->
    <script type="text/javascript" src="front-end/scripts/js/viewModel/server_config/alertsViewModel.js"></script>
    <script type="text/javascript" src="front-end/scripts/js/viewModel/server_config/addViewModel.js"></script>
    <script type="text/javascript" src="front-end/scripts/js/viewModel/server_config/searchUpdateViewModel.js"></script>

    <!-- classes for adding new server configurations -->
    <script type="text/javascript"  src="front-end/scripts/js/classes/Action.js"></script>
    <script type="text/javascript"  src="front-end/scripts/js/classes/Component.js"></script>
    <script type="text/javascript"  src="front-end/scripts/js/classes/Predicate.js"></script>
    <script type="text/javascript"  src="front-end/scripts/js/classes/NotPredicate.js"></script>
    <script type="text/javascript"  src="front-end/scripts/js/classes/AndPredicate.js"></script>
    <script type="text/javascript"  src="front-end/scripts/js/classes/OrPredicate.js"></script>

    <!-- Knockout code -->
    <script>
        /******* MASTER VIEW MODEL *******/
        var ServerConfigViewModel = {
            // view models
            searchUpdateViewModel : new SearchUpdateViewModel(),
            addViewModel : new AddViewModel(),
            alertsViewModel : AlertsViewModel,

            // variables
            serverList : ko.observableArray(),
            serverName : ko.observable("")
        };

        ServerConfigViewModel.getAllServerNames = function () {
            $.getJSON("/api/config/list_servers/", function(data) {
                ServerConfigViewModel.serverList.removeAll();
                for (i = 0; i < data.length; i++) {
                    ServerConfigViewModel.serverList.push(data[i]);
                }
            }).fail(function(data){
                alert("Failed Get for list servers " + JSON.stringify(data));
            });
            ServerConfigViewModel.serverList.sort();
        };

        // subscribe to changes in the server name
        ServerConfigViewModel.serverName.subscribe(function() {
            ServerConfigViewModel.capitalizeServerName();
            ServerConfigViewModel.searchUpdateViewModel.hide();
            ServerConfigViewModel.addViewModel.hide();
        });

        ServerConfigViewModel.capitalizeServerName = function() {
            ServerConfigViewModel.serverName(ServerConfigViewModel.serverName().toUpperCase());
        };

        ServerConfigViewModel.search = function() {
            ServerConfigViewModel.tearDown();
            ServerConfigViewModel.searchUpdateViewModel.search();
        };

        ServerConfigViewModel.add = function() {
            ServerConfigViewModel.tearDown();
            ServerConfigViewModel.addViewModel.add();
        };

        ServerConfigViewModel.clearPage = function() {
            ServerConfigViewModel.tearDown();
            ServerConfigViewModel.serverName("");
        };

        ServerConfigViewModel.tearDown = function() {
            ServerConfigViewModel.searchUpdateViewModel.tearDown();
            ServerConfigViewModel.addViewModel.tearDown();
            ServerConfigViewModel.alertsViewModel.closeAlerts();
        };

        /******* STARTUP CODE *******/
        ko.applyBindings(ServerConfigViewModel);
        ServerConfigViewModel.getAllServerNames();
    </script>

    <!-- miscellaneous JavaScript helpers -->
    <script type="text/javascript">
        // fill-in search bar when a server is selected by the user (from dropdown)
        function serverSelected(selection) {
            ServerConfigViewModel.serverName(selection);
            ServerConfigViewModel.search();
        }

        document.getElementById('searchBox').onkeypress = function(e){
            if (e.keyCode == '13'){
              // Enter pressed
              ServerConfigViewModel.search();
            }
          }
    </script>

    <!-- templates for adding server configurations -->
    <script type="text/html" id="component-template">
        <div class="panel panel-default success">
            <div class="panel-heading">
                <div class="btn-group">
                <a class="btn btn-default btn-lg disabled" role="button">
                    &lt;Component <span data-bind="text: ID"></span>&gt;
                </a>
                <button type="button" class="btn btn-primary btn-lg" data-bind="click: addAction">Add Action</button>
                </div>
            </div>
            <div class="panel-body">
                <form class="form-inline" role="form">
                    <div class="form-group">
                        <!-- required attributes -->
                        <input type="text" placeholder="id" data-bind="value: ID, text: ID">
                        <input type="text" placeholder="type" data-bind="value: compType, text: compType">
                        <input type="text" placeholder="script" data-bind="value: script, text: script">
                        <input type="text" placeholder="command" data-bind="value: command, text: command">
                        <input type="number" placeholder="restartmax" data-bind="value: restartmax, text: restartmax">
                        <input type="text" placeholder="registrationpath" data-bind="value: registrationpath, text: registrationpath">
                    </div>
                </form>
                <br />
                <div data-bind="template: {name: 'action-template', foreach: actions}"></div>
            </div>
        </div>
    </script>

    <script type="text/html" id="action-template">
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="btn-group">
                    <a class="btn btn-default disabled" role="button">
                        &lt;Action <span data-bind="text: ID"></span>&gt;
                    </a>
                    <div class="btn-group">
                      <button type="button" class="btn btn-primary" data-bind="click: addPredicate">Add Predicate</button>
                      <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu">
                        <li><a href="#" data-bind="click: addNotPredicate">NOT</a></li>
                        <li class="divider"></li>
                        <li><a href="#" data-bind="click: addAndPredicate">AND</a></li>
                        <li><a href="#" data-bind="click: addOrPredicate">OR</a></li>
                      </ul>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <form class="form-inline" role="form">
                    <div class="form-group">
                        <input type="text" placeholder="id" data-bind="value: ID, text: ID">
                        <input type="text" placeholder="staggerpath" data-bind="value: staggerpath, text: staggerpath">
                        <input type="text" placeholder="staggertime" data-bind="value: staggertime, text: staggertime">
                        <input type="number" placeholder="allowed_instances" data-bind="value: allowedinstances, text: allowedinstances">
                    </div>
                </form>
                <br />
                <div data-bind="template: {name: 'predicate-template', foreach: predicates}"></div>
            </div>
        </div>
    </script>

    <script type="text/html" id="predicate-template">
        <!-- ko if: predType == "and" -->
        <div data-bind="template: {name:'and-predicate-template'}"></div>
        <!-- /ko -->

        <!-- ko if: predType == "or" -->
        <div data-bind="template: {name:'or-predicate-template'}"></div>
        <!-- /ko -->

        <!-- ko if: predType == "not" -->
        <div data-bind="template: {name:'not-predicate-template'}"></div>
        <!-- /ko -->

        <!-- ko if: (predType != "and" && predType != "or" && predType != "not") -->
        <div data-bind="template: {name:'single-predicate-template'}"></div>
        <!-- /ko -->
    </script>

    <script type="text/html" id="single-predicate-template">
        <div class="panel panel-default">
            <div class="panel-heading">
                    <a class="btn btn-default disabled" role="button">
                        &lt;Predicate&gt;
                    </a>
            </div>
            <div class="panel-body">
                <form class="form-inline" role="form">
                    <div class="form-group">
                        <input type="text" placeholder="type" data-bind="text: predType, value:predType">
                        <input type="number" placeholder="interval" data-bind="text: interval, value: interval">
                        <input type="text" placeholder="command" data-bind="text: command, value: command">
                        <input type="text" placeholder="path" data-bind="text: path, value: path">
                    </div>
                </form>
            </div>
        </div>
    </script>

    <script type="text/html" id="and-predicate-template">
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="btn-group">
                    <a class="btn btn-default disabled" role="button">
                        &lt;AND&gt;
                    </a>
                    <button type="button" class="btn btn-primary" data-bind="click: addPredicate">Add Predicate</button>
                </div>
            </div>
            <div class="panel-body">
                <div data-bind="template: {name:'predicate-template', foreach: predicates}"></div>
            </div>
        </div>
    </script>

    <script type="text/html" id="or-predicate-template">
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="btn-group">
                    <a class="btn btn-default disabled" role="button">
                        &lt;OR&gt;
                    </a>
                    <button type="button" class="btn btn-primary" data-bind="click: addPredicate">Add Predicate</button>
                </div>
            </div>
            <div class="panel-body">
                <div data-bind="template: {name:'predicate-template', foreach: predicates}"></div>
            </div>
        </div>
    </script>

    <script type="text/html" id="not-predicate-template">
        <div class="panel panel-default">
            <div class="panel-heading">
                <a class="btn btn-default disabled" role="button">
                    &lt;NOT&gt;
                </a>
            </div>
            <div class="panel-body">
                <div data-bind="template: {name:'predicate-template', foreach: predicate}"></div>
            </div>
        </div>
    </script>
</html>
